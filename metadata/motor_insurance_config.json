{
  "dataflows": [
    {
      "name": "motor-ingestion",
      "sources": [
        {
          "name": "policy_inputs",
          "path": "data/input/events/motor_policy/*.jsonl",
          "format": "json"
        }
      ],
      "transformations": [
        {
          "name": "validation",
          "type": "validate_fields",
          "params": {
            "input": "policy_inputs",
            "validations": [
                {
                    "field": "policy_number",
                    "validations": ["notEmpty", "minLength:5"]
                },
                {
                    "field": "plate_number",
                    "validations": ["notEmpty", "plateFormat"]
                },
                {
                    "field": "driver_age",
                    "validations": ["notNull", "range:18-80"]
                },
                {
                    "field": "premium_amount",
                    "validations": ["notNull", "positive", "maxValue:10000"]
                }
                ]
          }
        },
        {
          "name": "add_ingestion_date",
          "type": "add_fields",
          "params": {
            "input": "validation_ok",
            "addFields": [
              {
                "name": "ingestion_dt",
                "function": "current_timestamp"
              }
            ]
          }
        }
      ],
      "sinks": [
        {
          "input": "add_ingestion_date",
          "name": "raw-ok",
          "paths": ["data/output/events/motor_policy"],
          "format": "json",
          "saveMode": "overwrite"
        },
        {
          "input": "validation_ko",
          "name": "raw-ko",
          "paths": ["data/output/discards/motor_policy"],
          "format": "json",
          "saveMode": "overwrite"
        }
      ]
    }
  ]
}